<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Viajeros - Delf√≠n Check-in</title>
    <meta name="description" content="Formulario de registro compatible con el Ministerio del Interior de Espa√±a">
    
    <!-- Enlaces hreflang para SEO -->
    <link rel="alternate" href="https://form.delfincheckin.com/?lang=es" hreflang="es">
    <link rel="alternate" href="https://form.delfincheckin.com/?lang=en" hreflang="en">
    <link rel="alternate" href="https://form.delfincheckin.com/?lang=fr" hreflang="fr">
    <link rel="alternate" href="https://form.delfincheckin.com/" hreflang="x-default">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        }
        .form-input { 
            width: 100%; 
            padding: 0.5rem 0.75rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.375rem; 
        }
        .form-input:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
        }
        .form-input.error { 
            border-color: #ef4444; 
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1); 
        }
        .btn-primary { 
            background-color: #2563eb; 
            color: white; 
            padding: 0.75rem 1rem; 
            border-radius: 0.375rem; 
            font-weight: 500; 
        }
        .btn-primary:hover { 
            background-color: #1d4ed8; 
        }
        .btn-primary:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
        }
        .success-message {
            display: none;
            background-color: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .error-message {
            display: none;
            background-color: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .field-error {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        .language-selector {
            position: relative;
            display: inline-block;
        }
        .language-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 10;
            min-width: 150px;
        }
        .language-dropdown.show {
            display: block;
        }
        .language-option {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }
        .language-option:hover {
            background-color: #f9fafb;
        }
        .language-option:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header con selector de idioma -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <div class="text-3xl mr-3">üê¨</div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Delf√≠n Check-in</h1>
                        <p class="text-sm text-gray-600" data-i18n="header.subtitle">Sistema de Registro de Viajeros</p>
                    </div>
                </div>
                <div class="language-selector">
                    <button type="button" id="languageButton" class="flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-900">
                        <span id="currentLanguage">üá™üá∏ Espa√±ol</span>
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option" data-lang="es">üá™üá∏ Espa√±ol</div>
                        <div class="language-option" data-lang="en">üá¨üáß English</div>
                        <div class="language-option" data-lang="fr">üá´üá∑ Fran√ßais</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- T√≠tulo principal centrado -->
        <div class="text-center mb-8">
            <div class="text-4xl mb-4">üê¨</div>
            <h2 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="title.main">
                Registro de parte de viajero
            </h2>
            <p class="text-lg text-gray-600" data-i18n="title.subtitle">
                Compatible con alta en el Ministerio del Interior de Espa√±a
            </p>
            <p class="text-sm text-gray-500 mt-2" data-i18n="title.instructions">
                Complete todos los campos obligatorios marcados con *
            </p>
        </div>

        <!-- Formulario funcional -->
        <div class="bg-white rounded-lg shadow-lg p-8">
            <form id="guestRegistrationForm" class="space-y-8">
                <!-- Secci√≥n Contrato -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <span data-i18n="contract.title">Contrato</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Campos ocultos con valores internos -->
                        <input type="hidden" id="codigoEstablecimiento" name="codigoEstablecimiento" value="0000256653">
                        <input type="hidden" id="referencia" name="referencia" value="0000146967">
                        
                        <div>
                            <label for="fechaContrato" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.date">Fecha contrato (DD/MM/AAAA)</span> *
                            </label>
                            <input type="text" id="fechaContrato" name="fechaContrato" placeholder="DD/MM/AAAA" required
                                   class="form-input" data-field="fechaContrato">
                            <div class="field-error" data-field="fechaContrato"></div>
                        </div>
                        
                        <div>
                            <label for="fechaEntrada" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.checkin">Entrada (DD/MM/AAAA)</span> *
                            </label>
                            <input type="text" id="fechaEntrada" name="fechaEntrada" placeholder="DD/MM/AAAA" required
                                   class="form-input" data-field="fechaEntrada">
                            <div class="field-error" data-field="fechaEntrada"></div>
                        </div>
                        
                        <div>
                            <label for="fechaSalida" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.checkout">Salida (DD/MM/AAAA)</span> *
                            </label>
                            <input type="text" id="fechaSalida" name="fechaSalida" placeholder="DD/MM/AAAA" required
                                   class="form-input" data-field="fechaSalida">
                            <div class="field-error" data-field="fechaSalida"></div>
                        </div>
                        
                        <div>
                            <label for="numHabitaciones" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.rooms">N¬∫ habitaciones</span>
                            </label>
                            <input type="number" id="numHabitaciones" name="numHabitaciones" value="2" min="1"
                                   class="form-input" data-field="numHabitaciones">
                            <div class="field-error" data-field="numHabitaciones"></div>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="internet" name="internet" class="h-4 w-4 text-blue-600 rounded">
                            <label for="internet" class="ml-2 text-sm text-gray-700" data-i18n="contract.internet">
                                Internet
                            </label>
                        </div>
                        
                        <div>
                            <label for="tipoPago" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.paymentType">Tipo de pago</span> *
                            </label>
                            <select id="tipoPago" name="tipoPago" required class="form-input" data-field="tipoPago">
                                <option value="TARJT">Tarjeta</option>
                                <option value="EFECT">Efectivo</option>
                                <option value="TRANS">Transferencia</option>
                                <option value="PLATF">Plataforma</option>
                                <option value="MOVIL">M√≥vil</option>
                                <option value="OTRO">Otros</option>
                            </select>
                            <div class="field-error" data-field="tipoPago"></div>
                        </div>
                        
                        <div>
                            <label for="medioPago" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.paymentMethod">Medio de pago</span>
                            </label>
                            <input type="text" id="medioPago" name="medioPago" value="VISA ****1234"
                                   class="form-input" data-field="medioPago">
                            <div class="field-error" data-field="medioPago"></div>
                        </div>
                        
                        <div>
                            <label for="fechaPago" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.paymentDate">Fecha de pago (DD/MM/AAAA)</span>
                            </label>
                            <input type="text" id="fechaPago" name="fechaPago" placeholder="DD/MM/AAAA"
                                   class="form-input" data-field="fechaPago">
                            <div class="field-error" data-field="fechaPago"></div>
                        </div>
                        
                        <div>
                            <label for="titular" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.cardholder">Titular</span>
                            </label>
                            <input type="text" id="titular" name="titular" value="juan ejemplo"
                                   class="form-input" data-field="titular">
                            <div class="field-error" data-field="titular"></div>
                        </div>
                        
                        <div>
                            <label for="caducidadTarjeta" class="block text-sm font-medium text-gray-700 mb-2">
                                <span data-i18n="contract.expiry">Caducidad (MM/AAAA)</span>
                            </label>
                            <input type="text" id="caducidadTarjeta" name="caducidadTarjeta" placeholder="MM/AAAA"
                                   class="form-input" data-field="caducidadTarjeta">
                            <div class="field-error" data-field="caducidadTarjeta"></div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n Viajeros -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <span data-i18n="travelers.title">Viajeros</span>
                    </h3>
                    
                    <div id="travelersContainer">
                        <div class="traveler-section border rounded-lg p-6 bg-gray-50">
                            <h4 class="text-md font-medium text-gray-900 mb-4" data-i18n="travelers.traveler1">Viajero 1</h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.name">Nombre</span> *
                                    </label>
                                    <input type="text" id="nombre" name="nombre" value="juanillo" required
                                           class="form-input" data-field="nombre">
                                    <div class="field-error" data-field="nombre"></div>
                                </div>
                                
                                <div>
                                    <label for="apellido1" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.surname1">Primer apellido</span> *
                                    </label>
                                    <input type="text" id="apellido1" name="apellido1" value="ejemplo" required
                                           class="form-input" data-field="apellido1">
                                    <div class="field-error" data-field="apellido1"></div>
                                </div>
                                
                                <div>
                                    <label for="apellido2" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.surname2">Segundo apellido</span>
                                    </label>
                                    <input type="text" id="apellido2" name="apellido2"
                                           class="form-input" data-field="apellido2">
                                    <div class="field-error" data-field="apellido2"></div>
                                </div>
                                
                                <div>
                                    <label for="fechaNacimiento" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.birthDate">Fecha nacimiento (DD/MM/AAAA)</span> *
                                    </label>
                                    <input type="text" id="fechaNacimiento" name="fechaNacimiento" placeholder="DD/MM/AAAA" required
                                           class="form-input" data-field="fechaNacimiento">
                                    <div class="field-error" data-field="fechaNacimiento"></div>
                                </div>
                                
                                <div>
                                    <label for="tipoDocumento" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.docType">Tipo documento</span>
                                    </label>
                                    <select id="tipoDocumento" name="tipoDocumento" class="form-input" data-field="tipoDocumento">
                                        <option value="Pasaporte">Pasaporte</option>
                                        <option value="DNI">DNI</option>
                                        <option value="NIE">NIE</option>
                                        <option value="Otros">Otros</option>
                                    </select>
                                    <div class="field-error" data-field="tipoDocumento"></div>
                                </div>
                                
                                <div>
                                    <label for="numeroDocumento" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.docNumber">N√∫mero documento</span>
                                    </label>
                                    <input type="text" id="numeroDocumento" name="numeroDocumento" value="paf34514f"
                                           class="form-input" data-field="numeroDocumento">
                                    <div class="field-error" data-field="numeroDocumento"></div>
                                </div>
                                
                                <div>
                                    <label for="nacionalidad" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.nationality">Nacionalidad (ISO3)</span>
                                    </label>
                                    <input type="text" id="nacionalidad" name="nacionalidad" value="ESP"
                                           class="form-input" data-field="nacionalidad">
                                    <div class="field-error" data-field="nacionalidad"></div>
                                </div>
                                
                                <div>
                                    <label for="sexo" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.gender">Sexo</span>
                                    </label>
                                    <select id="sexo" name="sexo" class="form-input" data-field="sexo">
                                        <option value="Hombre">Hombre</option>
                                        <option value="Mujer">Mujer</option>
                                        <option value="Otro">Otro</option>
                                    </select>
                                    <div class="field-error" data-field="sexo"></div>
                                </div>
                                
                                <div>
                                    <label for="telefono" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.phone">Tel√©fono</span>
                                    </label>
                                    <input type="tel" id="telefono" name="telefono"
                                           class="form-input" data-field="telefono">
                                    <div class="field-error" data-field="telefono"></div>
                                </div>
                                
                                <div>
                                    <label for="correo" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.email">Correo electr√≥nico</span>
                                    </label>
                                    <input type="email" id="correo" name="correo"
                                           class="form-input" data-field="correo">
                                    <div class="field-error" data-field="correo"></div>
                                </div>
                                
                                <div>
                                    <label for="direccion" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.address">Direcci√≥n</span> *
                                    </label>
                                    <input type="text" id="direccion" name="direccion" value="calle x ejemplo" required
                                           class="form-input" data-field="direccion">
                                    <div class="field-error" data-field="direccion"></div>
                                </div>
                                
                                <div>
                                    <label for="codigoPostal" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.postalCode">C√≥digo postal</span> *
                                    </label>
                                    <input type="text" id="codigoPostal" name="codigoPostal" value="29645" required
                                           class="form-input" data-field="codigoPostal">
                                    <div class="field-error" data-field="codigoPostal"></div>
                                </div>
                                
                                <div>
                                    <label for="pais" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.country">Pa√≠s (ISO3)</span> *
                                    </label>
                                    <select id="pais" name="pais" required class="form-input" data-field="pais">
                                        <option value="ESP">Espa√±a</option>
                                        <option value="FRA">Francia</option>
                                        <option value="GBR">Reino Unido</option>
                                        <option value="DEU">Alemania</option>
                                        <option value="ITA">Italia</option>
                                        <option value="USA">Estados Unidos</option>
                                        <option value="Other">Otro pa√≠s</option>
                                    </select>
                                    <div class="field-error" data-field="pais"></div>
                                </div>
                                
                                <div>
                                    <label for="codigoMunicipio" class="block text-sm font-medium text-gray-700 mb-2">
                                        <span data-i18n="travelers.municipality">C√≥digo municipio INE (5)</span> *
                                    </label>
                                    <input type="text" id="codigoMunicipio" name="codigoMunicipio" value="+34" required
                                           class="form-input" data-field="codigoMunicipio">
                                    <div class="field-error" data-field="codigoMunicipio"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n de env√≠o -->
                <div class="flex justify-center">
                    <button type="submit" id="submitButton" class="btn-primary flex items-center">
                        <svg class="h-5 w-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span data-i18n="submit.button">Enviar Registro</span>
                    </button>
                </div>
            </form>

            <!-- Mensajes de √©xito y error -->
            <div id="successMessage" class="success-message">
                <div class="flex items-center">
                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span data-i18n="success.message">¬°Registro enviado correctamente!</span>
                </div>
            </div>

            <div id="errorMessage" class="error-message">
                <div class="flex items-center">
                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    <span data-i18n="error.message">Error al enviar el registro. Por favor, int√©ntelo de nuevo.</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de idiomas mejorada
        const SUPPORTED_LANGS = ["es", "en", "fr"];
        
        const translations = {
            es: {
                "header.subtitle": "Sistema de Registro de Viajeros",
                "title.main": "Registro de parte de viajero",
                "title.subtitle": "Compatible con alta en el Ministerio del Interior de Espa√±a",
                "title.instructions": "Complete todos los campos obligatorios marcados con *",
                "contract.title": "Contrato",
                "contract.establishment": "C√≥digo establecimiento",
                "contract.reference": "Referencia",
                "contract.date": "Fecha contrato (DD/MM/AAAA)",
                "contract.checkin": "Entrada (DD/MM/AAAA)",
                "contract.checkout": "Salida (DD/MM/AAAA)",
                "contract.rooms": "N¬∫ habitaciones",
                "contract.internet": "Internet",
                "contract.paymentType": "Tipo de pago",
                "contract.paymentMethod": "Medio de pago",
                "contract.paymentDate": "Fecha de pago (DD/MM/AAAA)",
                "contract.cardholder": "Titular",
                "contract.expiry": "Caducidad (MM/AAAA)",
                "travelers.title": "Viajeros",
                "travelers.traveler1": "Viajero 1",
                "travelers.name": "Nombre",
                "travelers.surname1": "Primer apellido",
                "travelers.surname2": "Segundo apellido",
                "travelers.birthDate": "Fecha nacimiento (DD/MM/AAAA)",
                "travelers.docType": "Tipo documento",
                "travelers.docNumber": "N√∫mero documento",
                "travelers.nationality": "Nacionalidad (ISO3)",
                "travelers.gender": "Sexo",
                "travelers.phone": "Tel√©fono",
                "travelers.email": "Correo electr√≥nico",
                "travelers.address": "Direcci√≥n",
                "travelers.postalCode": "C√≥digo postal",
                "travelers.country": "Pa√≠s (ISO3)",
                "travelers.municipality": "C√≥digo municipio INE (5)",
                "submit.button": "Enviar Registro",
                "submit.sending": "Enviando...",
                "success.title": "¬°Registro enviado correctamente!",
                "success.message": "Hemos recibido tus datos correctamente. Los datos han sido enviados al sistema de administraci√≥n.",
                "error.title": "Error al enviar",
                "error.message": "No se pudo enviar el registro. Por favor, revisa los campos o int√©ntalo m√°s tarde.",
                "required.field": "Este campo es obligatorio",
                "invalid.date": "Formato de fecha inv√°lido. Use DD/MM/AAAA",
                "invalid.email": "Formato de email inv√°lido",
                "invalid.phone": "Formato de tel√©fono inv√°lido",
                "invalid.postal": "C√≥digo postal debe tener 5 d√≠gitos",
                "date.range": "La fecha de entrada debe ser anterior a la de salida"
            },
            en: {
                "header.subtitle": "Traveler Registration System",
                "title.main": "Traveler Registration Form",
                "title.subtitle": "Compatible with Spanish Interior Ministry registration",
                "title.instructions": "Complete all required fields marked with *",
                "contract.title": "Contract",
                "contract.establishment": "Establishment code",
                "contract.reference": "Reference",
                "contract.date": "Contract date (DD/MM/YYYY)",
                "contract.checkin": "Check-in (DD/MM/YYYY)",
                "contract.checkout": "Check-out (DD/MM/YYYY)",
                "contract.rooms": "Number of rooms",
                "contract.internet": "Internet",
                "contract.paymentType": "Payment type",
                "contract.paymentMethod": "Payment method",
                "contract.paymentDate": "Payment date (DD/MM/YYYY)",
                "contract.cardholder": "Cardholder",
                "contract.expiry": "Expiry (MM/YYYY)",
                "travelers.title": "Travelers",
                "travelers.traveler1": "Traveler 1",
                "travelers.name": "Name",
                "travelers.surname1": "First surname",
                "travelers.surname2": "Second surname",
                "travelers.birthDate": "Birth date (DD/MM/YYYY)",
                "travelers.docType": "Document type",
                "travelers.docNumber": "Document number",
                "travelers.nationality": "Nationality (ISO3)",
                "travelers.gender": "Gender",
                "travelers.phone": "Phone",
                "travelers.email": "Email",
                "travelers.address": "Address",
                "travelers.postalCode": "Postal code",
                "travelers.country": "Country (ISO3)",
                "travelers.municipality": "Municipality INE code (5)",
                "submit.button": "Send Registration",
                "submit.sending": "Sending...",
                "success.title": "Registration sent successfully!",
                "success.message": "We have received your data correctly. The data has been sent to the administration system.",
                "error.title": "Error sending",
                "error.message": "The registration could not be sent. Please check the fields or try again later.",
                "required.field": "This field is required",
                "invalid.date": "Invalid date format. Use DD/MM/YYYY",
                "invalid.email": "Invalid email format",
                "invalid.phone": "Invalid phone format",
                "invalid.postal": "Postal code must have 5 digits",
                "date.range": "Check-in date must be before check-out date"
            },
            fr: {
                "header.subtitle": "Syst√®me d'enregistrement des voyageurs",
                "title.main": "Formulaire d'enregistrement des voyageurs",
                "title.subtitle": "Compatible avec l'enregistrement du minist√®re de l'Int√©rieur espagnol",
                "title.instructions": "Remplissez tous les champs obligatoires marqu√©s avec *",
                "contract.title": "Contrat",
                "contract.establishment": "Code de l'√©tablissement",
                "contract.reference": "R√©f√©rence",
                "contract.date": "Date du contrat (JJ/MM/AAAA)",
                "contract.checkin": "Arriv√©e (JJ/MM/AAAA)",
                "contract.checkout": "D√©part (JJ/MM/AAAA)",
                "contract.rooms": "Nombre de chambres",
                "contract.internet": "Internet",
                "contract.paymentType": "Type de paiement",
                "contract.paymentMethod": "M√©thode de paiement",
                "contract.paymentDate": "Date de paiement (JJ/MM/AAAA)",
                "contract.cardholder": "Titulaire",
                "contract.expiry": "Expiration (MM/AAAA)",
                "travelers.title": "Voyageurs",
                "travelers.traveler1": "Voyageur 1",
                "travelers.name": "Nom",
                "travelers.surname1": "Premier nom de famille",
                "travelers.surname2": "Deuxi√®me nom de famille",
                "travelers.birthDate": "Date de naissance (JJ/MM/AAAA)",
                "travelers.docType": "Type de document",
                "travelers.docNumber": "Num√©ro de document",
                "travelers.nationality": "Nationalit√© (ISO3)",
                "travelers.gender": "Sexe",
                "travelers.phone": "T√©l√©phone",
                "travelers.email": "Email",
                "travelers.address": "Adresse",
                "travelers.postalCode": "Code postal",
                "travelers.country": "Pays (ISO3)",
                "travelers.municipality": "Code municipal INE (5)",
                "submit.button": "Envoyer l'enregistrement",
                "submit.sending": "Envoi...",
                "success.title": "Enregistrement envoy√© avec succ√®s !",
                "success.message": "Nous avons bien re√ßu vos informations. Les donn√©es ont √©t√© envoy√©es au syst√®me d'administration.",
                "error.title": "Erreur d'envoi",
                "error.message": "L'envoi a √©chou√©. Veuillez v√©rifier les champs ou r√©essayer plus tard.",
                "required.field": "Ce champ est obligatoire",
                "invalid.date": "Format de date invalide. Utilisez JJ/MM/AAAA",
                "invalid.email": "Format d'email invalide",
                "invalid.phone": "Format de t√©l√©phone invalide",
                "invalid.postal": "Le code postal doit avoir 5 chiffres",
                "date.range": "La date d'arriv√©e doit √™tre ant√©rieure √† la date de d√©part"
            }
        };

        let currentLanguage = 'es';

        // Obtiene el idioma actual: ?lang=, luego localStorage, luego navegador
        function getCurrentLang() {
            const urlLang = new URLSearchParams(location.search).get("lang");
            const saved = localStorage.getItem("lang");
            const nav = (navigator.language || "es").slice(0,2).toLowerCase();
            const candidate = urlLang || saved || nav || "es";
            return SUPPORTED_LANGS.includes(candidate) ? candidate : "es";
        }

        // Aplica traducciones a los nodos con data-i18n="clave"
        function applyTranslations(lang) {
            const dict = translations[lang] || translations.es;
            document.documentElement.setAttribute("lang", lang);
            document.querySelectorAll("[data-i18n]").forEach(el => {
                const key = el.getAttribute("data-i18n");
                if (dict[key]) el.textContent = dict[key];
            });
            // Placeholders
            document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
                const key = el.getAttribute("data-i18n-placeholder");
                if (dict[key]) el.setAttribute("placeholder", dict[key]);
            });
        }

        // Cambia el idioma y persiste en URL + localStorage
        function setLang(lang) {
            if (!SUPPORTED_LANGS.includes(lang)) return;
            currentLanguage = lang;
            localStorage.setItem("lang", lang);
            const url = new URL(location.href);
            url.searchParams.set("lang", lang);
            history.replaceState({}, "", url); // no recarga
            
            const langTexts = {
                'es': 'üá™üá∏ Espa√±ol',
                'en': 'üá¨üáß English',
                'fr': 'üá´üá∑ Fran√ßais'
            };
            
            document.getElementById('currentLanguage').textContent = langTexts[lang];
            document.getElementById('languageDropdown').classList.remove('show');
            applyTranslations(lang);
        }

        // Obtiene textos de i18n imperativamente (para mensajes din√°micos)
        function t(key, lang = currentLanguage) {
            return (translations[lang] && translations[lang][key]) || translations.es[key] || key;
        }

        // Funci√≥n para cambiar idioma (mantener compatibilidad)
        function changeLanguage(lang) {
            setLang(lang);
        }

        // Funci√≥n para validar campos
        function validateField(field, value, required = false) {
            const errorElement = document.querySelector(`[data-field="${field}"]`);
            const inputElement = document.getElementById(field);
            
            // Limpiar estado anterior
            inputElement.classList.remove('error');
            errorElement.style.display = 'none';
            
            // Validaci√≥n de campo requerido
            if (required && (!value || value.trim() === '')) {
                inputElement.classList.add('error');
                errorElement.style.display = 'block';
                errorElement.textContent = getErrorMessage(field, 'required');
                return false;
            }
            
            // Validaciones espec√≠ficas por tipo de campo
            if (value && value.trim() !== '') {
                // Validaci√≥n de fechas
                if (field === 'fechaContrato' || field === 'fechaPago') {
                    if (!isValidDate(value)) {
                        inputElement.classList.add('error');
                        errorElement.style.display = 'block';
                        errorElement.textContent = getErrorMessage(field, 'invalidDate');
                        return false;
                    }
                }
                
                // Validaci√≥n de fechas
                if (field === 'fechaEntrada' || field === 'fechaSalida') {
                    if (!isValidDate(value)) {
                        inputElement.classList.add('error');
                        errorElement.style.display = 'block';
                        errorElement.textContent = getErrorMessage(field, 'invalidDate');
                        return false;
                    }
                }
                
                // Validaci√≥n de email
                if (field === 'correo' && value) {
                    if (!isValidEmail(value)) {
                        inputElement.classList.add('error');
                        errorElement.style.display = 'block';
                        errorElement.textContent = getErrorMessage(field, 'invalidEmail');
                        return false;
                    }
                }
                
                // Validaci√≥n de tel√©fono
                if (field === 'telefono' && value) {
                    if (!isValidPhone(value)) {
                        inputElement.classList.add('error');
                        errorElement.style.display = 'block';
                        errorElement.textContent = getErrorMessage(field, 'invalidPhone');
                        return false;
                    }
                }
                
                // Validaci√≥n de c√≥digo postal
                if (field === 'codigoPostal' && value) {
                    if (!isValidPostalCode(value)) {
                        inputElement.classList.add('error');
                        errorElement.style.display = 'block';
                        errorElement.textContent = getErrorMessage(field, 'invalidPostalCode');
                        return false;
                    }
                }
            }
            
            // Validaci√≥n de rango de fechas
            if (field === 'fechaEntrada' || field === 'fechaSalida') {
                const entrada = document.getElementById('fechaEntrada').value;
                const salida = document.getElementById('fechaSalida').value;
                
                if (entrada && salida && entrada >= salida) {
                    const entradaElement = document.getElementById('fechaEntrada');
                    const salidaElement = document.getElementById('fechaSalida');
                    const entradaError = document.querySelector(`[data-field="fechaEntrada"]`);
                    const salidaError = document.querySelector(`[data-field="fechaSalida"]`);
                    
                    entradaElement.classList.add('error');
                    salidaElement.classList.add('error');
                    entradaError.style.display = 'block';
                    salidaError.style.display = 'block';
                    entradaError.textContent = getErrorMessage('fechaEntrada', 'dateRange');
                    salidaError.textContent = getErrorMessage('fechaSalida', 'dateRange');
                    return false;
                }
            }
            
            // Si pasa todas las validaciones
            return true;
        }

        // Funci√≥n para validar fecha (DD/MM/AAAA)
        function isValidDate(dateString) {
            const dateRegex = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
            const match = dateString.match(dateRegex);
            
            if (!match) return false;
            
            const day = parseInt(match[1]);
            const month = parseInt(match[2]);
            const year = parseInt(match[3]);
            
            // Validar rangos
            if (day < 1 || day > 31 || month < 1 || month > 12 || year < 1900 || year > 2100) {
                return false;
            }
            
            // Crear fecha y validar que sea v√°lida
            const date = new Date(year, month - 1, day);
            return date.getDate() === day && date.getMonth() === month - 1 && date.getFullYear() === year;
        }

        // Funci√≥n para convertir fecha DD/MM/AAAA a AAAA-MM-DD para la API
        function convertDateToAPI(dateString) {
            const dateRegex = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
            const match = dateString.match(dateRegex);
            
            if (!match) return dateString;
            
            const day = match[1].padStart(2, '0');
            const month = match[2].padStart(2, '0');
            const year = match[3];
            
            return `${year}-${month}-${day}`;
        }

        // Funci√≥n para validar email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Funci√≥n para validar tel√©fono
        function isValidPhone(phone) {
            const phoneRegex = /^[\+]?[0-9\s\-\(\)]{9,}$/;
            return phoneRegex.test(phone);
        }

        // Funci√≥n para validar c√≥digo postal
        function isValidPostalCode(postalCode) {
            const postalRegex = /^[0-9]{5}$/;
            return postalRegex.test(postalCode);
        }

        // Funci√≥n para obtener mensajes de error en el idioma correcto
        function getErrorMessage(field, type) {
            const errorKeyMap = {
                required: "required.field",
                invalidDate: "invalid.date",
                invalidEmail: "invalid.email",
                invalidPhone: "invalid.phone",
                invalidPostalCode: "invalid.postal",
                dateRange: "date.range"
            };
            
            const key = errorKeyMap[type] || "required.field";
            return t(key, currentLanguage);
        }

        // Funci√≥n para limpiar errores
        function clearErrors() {
            document.querySelectorAll('.field-error').forEach(error => {
                error.style.display = 'none';
            });
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error');
            });
        }

        // Funci√≥n para mostrar resumen de errores
        function showErrorSummary(errors) {
            const errorMessage = document.getElementById('errorMessage');
            const errorText = errorMessage.querySelector('span');
            
            const errorTitle = t("error.title", currentLanguage);
            const errorBody = t("error.message", currentLanguage);
            
            errorText.textContent = `${errorTitle}: ${errorBody}`;
            errorMessage.style.display = 'block';
        }

        // Funci√≥n para determinar el tipo de error de un campo
        function getFieldErrorType(field, value) {
            if (field === 'correo') return 'invalidEmail';
            if (field === 'telefono') return 'invalidPhone';
            if (field === 'codigoPostal') return 'invalidPostalCode';
            if (field === 'fechaPago') return 'invalidDate';
            return 'required';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM CARGADO - Configurando formulario...');
            
            // ===== Inicializaci√≥n i18n =====
            const initialLang = getCurrentLang();
            currentLanguage = initialLang;
            applyTranslations(initialLang);
            
            // Configurar fechas por defecto en formato DD/MM/AAAA
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 2);
            
            const formatDate = (date) => {
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            };
            
            document.getElementById('fechaContrato').value = formatDate(today);
            document.getElementById('fechaEntrada').value = formatDate(today);
            document.getElementById('fechaSalida').value = formatDate(tomorrow);
            document.getElementById('fechaNacimiento').value = '11/06/1987';
            
            // Selector de idioma
            document.getElementById('languageButton').addEventListener('click', function() {
                document.getElementById('languageDropdown').classList.toggle('show');
            });
            
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    setLang(lang);
                });
            });
            
            // Cerrar dropdown al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.language-selector')) {
                    document.getElementById('languageDropdown').classList.remove('show');
                }
            });
            
            console.log('‚úÖ DOMContentLoaded completado - Formulario configurado');
        });

        // Manejo del formulario - VERSI√ìN ROBUSTA
        console.log('üîß Configurando event listener del formulario...');
        
        const form = document.getElementById('guestRegistrationForm');
        console.log('üìù Formulario encontrado:', form);
        
        if (!form) {
            console.error('‚ùå NO SE ENCONTR√ì EL FORMULARIO!');
            return;
        }
        
        form.addEventListener('submit', async function(e) {
            console.log('üéØ EVENTO SUBMIT DISPARADO!');
            e.preventDefault();
            
            // Limpiar errores anteriores
            clearErrors();
            
            const submitButton = document.getElementById('submitButton');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            // Ocultar mensajes anteriores
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            // Validar campos obligatorios
            const requiredFields = [
                'fechaContrato', 'fechaEntrada', 'fechaSalida', 'tipoPago', 
                'nombre', 'apellido1', 'fechaNacimiento', 'direccion', 
                'codigoPostal', 'pais', 'codigoMunicipio'
            ];
            
            let isValid = true;
            const errors = [];
            
            // Validar cada campo y recopilar errores
            requiredFields.forEach(field => {
                const value = document.getElementById(field).value;
                if (!validateField(field, value, true)) {
                    isValid = false;
                    const fieldLabel = document.querySelector(`label[for="${field}"]`).textContent.replace(' *', '').trim();
                    errors.push(`‚Ä¢ ${fieldLabel}: ${getErrorMessage(field, 'required')}`);
                }
            });
            
            // Validar campos opcionales que tienen formato espec√≠fico
            const optionalFields = ['correo', 'telefono', 'fechaPago'];
            optionalFields.forEach(field => {
                const value = document.getElementById(field).value;
                if (value && !validateField(field, value, false)) {
                    isValid = false;
                    const fieldLabel = document.querySelector(`label[for="${field}"]`).textContent.replace(' *', '').trim();
                    const errorType = getFieldErrorType(field, value);
                    errors.push(`‚Ä¢ ${fieldLabel}: ${getErrorMessage(field, errorType)}`);
                }
            });
            
            // Si hay errores, mostrarlos y detener el env√≠o
            if (!isValid) {
                showErrorSummary(errors);
                return;
            }
            
            // Deshabilitar bot√≥n y mostrar estado de env√≠o
            submitButton.disabled = true;
            submitButton.innerHTML = `
                <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                ${t("submit.sending", currentLanguage)}
            `;
            
            try {
                console.log('üöÄ Iniciando env√≠o del formulario...');
                
                // Recopilar datos del formulario
                const formData = new FormData(e.target);
                
                // Log de datos recopilados
                console.log('üìã Datos del formulario:', {
                    fechaContrato: formData.get('fechaContrato'),
                    fechaEntrada: formData.get('fechaEntrada'),
                    fechaSalida: formData.get('fechaSalida'),
                    nombre: formData.get('nombre'),
                    apellido1: formData.get('apellido1'),
                    fechaNacimiento: formData.get('fechaNacimiento')
                });
                
                // Crear payload robusto
                const data = {
                    codigoEstablecimiento: "0000256653", // Valor fijo interno
                    comunicaciones: [{
                        contrato: {
                            referencia: "0000146967", // Valor fijo interno
                            fechaContrato: convertDateToAPI(formData.get('fechaContrato')),
                            fechaEntrada: convertDateToAPI(formData.get('fechaEntrada')),
                            fechaSalida: convertDateToAPI(formData.get('fechaSalida')),
                            numPersonas: 1,
                            numHabitaciones: parseInt(formData.get('numHabitaciones')) || 1,
                            internet: formData.get('internet') === 'on',
                            pago: {
                                tipoPago: formData.get('tipoPago'),
                                fechaPago: formData.get('fechaPago') ? convertDateToAPI(formData.get('fechaPago')) : '',
                                medioPago: formData.get('medioPago') || '',
                                titular: formData.get('titular') || '',
                                caducidadTarjeta: formData.get('caducidadTarjeta') || '',
                            },
                        },
                        personas: [{
                            rol: "VI",
                            nombre: formData.get('nombre'),
                            apellido1: formData.get('apellido1'),
                            apellido2: formData.get('apellido2') || '',
                            tipoDocumento: formData.get('tipoDocumento'),
                            numeroDocumento: formData.get('numeroDocumento') || '',
                            soporteDocumento: '',
                            fechaNacimiento: convertDateToAPI(formData.get('fechaNacimiento')),
                            nacionalidad: formData.get('nacionalidad'),
                            sexo: formData.get('sexo'),
                            contacto: { 
                                telefono: formData.get('telefono') || '', 
                                telefono2: '', 
                                correo: formData.get('correo') || '' 
                            },
                            direccion: {
                                direccion: formData.get('direccion'),
                                direccionComplementaria: '',
                                codigoPostal: formData.get('codigoPostal'),
                                pais: formData.get('pais'),
                                codigoMunicipio: formData.get('codigoMunicipio') || '',
                                nombreMunicipio: '',
                            },
                        }],
                    }],
                };
                
                // Log de datos a enviar
                console.log('üì§ Datos a enviar a la API:', data);
                console.log('üåê Enviando a:', 'https://admin.delfincheckin.com/api/public/guest-registration');
                
                // Enviar datos a la API p√∫blica del dashboard con CORS correcto
                const response = await fetch('https://admin.delfincheckin.com/api/public/guest-registration', {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });
                
                console.log('üì• Respuesta recibida:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `Error ${response.status}: ${response.statusText}`);
                }
                
                const responseData = await response.json();
                console.log('‚úÖ Respuesta exitosa:', responseData);
                
                // Mostrar mensaje de √©xito seg√∫n el idioma
                const successTitle = t("success.title", currentLanguage);
                const successBody = t("success.message", currentLanguage);
                
                successMessage.querySelector('span').textContent = `${successTitle} ${successBody}`;
                successMessage.style.display = 'block';
                
                // Limpiar el formulario despu√©s del √©xito
                e.target.reset();
                
                // Restaurar fechas por defecto
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 2);
                
                const formatDate = (date) => {
                    const day = date.getDate().toString().padStart(2, '0');
                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                };
                
                document.getElementById('fechaContrato').value = formatDate(today);
                document.getElementById('fechaEntrada').value = formatDate(today);
                document.getElementById('fechaSalida').value = formatDate(tomorrow);
                document.getElementById('fechaNacimiento').value = '11/06/1987';
                
                // Redirigir al dashboard despu√©s de 5 segundos
                setTimeout(() => {
                    window.open('https://admin.delfincheckin.com/guest-registrations-dashboard', '_blank');
                }, 5000);
                
            } catch (error) {
                console.error('‚ùå Error en el env√≠o:', error);
                
                // Mostrar mensaje de error espec√≠fico
                const errorTitle = t("error.title", currentLanguage);
                const errorBody = t("error.message", currentLanguage);
                
                errorMessage.querySelector('span').textContent = `${errorTitle}: ${errorBody}`;
                errorMessage.style.display = 'block';
            } finally {
                // Restaurar bot√≥n
                submitButton.disabled = false;
                const buttonText = t("submit.button", currentLanguage);
                submitButton.innerHTML = `
                    <svg class="h-5 w-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    ${buttonText}
                `;
            }
        });
    </script>
</body>
</html>
